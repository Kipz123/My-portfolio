<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Admin - Add Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css?family=Poppins:400,400i,500,500i,600,600i,700,700i,800,800i,900,900i"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,400i,600,600i,700" rel="stylesheet">
    <!-- Template CSS Files -->
    <link href="AllanKaino.net/portfolio/css/bootstrap.min.css" rel="stylesheet">
    <link href="AllanKaino.net/portfolio/css/component.css" rel="stylesheet">
    <link href="AllanKaino.net/portfolio/css/circle.css" rel="stylesheet">
    <link href="AllanKaino.net/portfolio/css/font-awesome.min.css" rel="stylesheet">
    <link href="AllanKaino.net/portfolio/css/style.css" rel="stylesheet">
    <link href="AllanKaino.net/portfolio/css/skins/yellow.css" rel="stylesheet">
    <script src="AllanKaino.net/portfolio/js/modernizr.min.js"></script>
    <style>
        .form-control {
            background-color: #222;
            border: 1px solid #444;
            color: #fff;
        }

        .form-control:focus {
            background-color: #333;
            color: #fff;
            border-color: #ffb400;
        }
    </style>
</head>

<body class="dark blog-page">
    <header class="header" id="navbar-collapse-toggle">
        <ul id="desktop-nav" class="icon-menu d-none d-lg-block">
            <li class="icon-box desktop-nav-element"
                onclick="window.location.href='/AllanKaino.net/portfolio/dark.html'" style="cursor: pointer;">
                <i class="fa fa-home"></i>
            </li>
        </ul>
    </header>

    <div class="pages">
        <div class="page page--current">
            <div class="container main-container">
                <div class="title-section text-left text-sm-center">
                    <h2>Admin <span>Panel</span></h2>
                    <span class="title-bg">Manage</span>
                </div>
                <div class="row">
                    <!-- Create Blog Form -->
                    <div class="col-12 col-lg-6">
                        <h3 class="text-white mb-4">Create New Blog</h3>
                        <form id="blogForm" class="contactform">
                            <div class="contactform">
                                <div class="row">
                                    <div class="col-12 mb-3">
                                        <input type="text" class="form-control" id="title" name="title"
                                            placeholder="Blog Title" required>
                                    </div>
                                    <div class="col-12 mb-3">
                                        <input type="text" class="form-control" id="author" name="author"
                                            placeholder="Author Name" required>
                                    </div>
                                    <div class="col-12 mb-3">
                                        <textarea class="form-control" id="content" name="content" rows="8"
                                            placeholder="Blog Content" required></textarea>
                                    </div>
                                    <div class="col-12 mb-3">
                                        <label class="text-white">Thumbnail Image:</label>
                                        <input type="file" class="form-control" id="image" name="image" accept="image/*"
                                            required>
                                    </div>
                                    <div class="col-12">
                                        <button type="submit" class="button">
                                            <span class="button-text">Post Article</span>
                                            <span class="button-icon fa fa-send"></span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Manage Blogs List -->
                    <div class="col-12 col-lg-6">
                        <h3 class="text-white mb-4">Manage Blogs</h3>
                        <div id="blog-list" class="contactform">
                            <!-- JS will populate this -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="AllanKaino.net/portfolio/js/jquery-3.5.0.min.js"></script>
    <script src="AllanKaino.net/portfolio/js/bootstrap.min.js"></script>
    <script>
        // Fetch and display blogs
        function fetchBlogs() {
            fetch('/api/blogs')
                .then(response => response.json())
                .then(blogs => {
                    const listContainer = document.getElementById('blog-list');
                    listContainer.innerHTML = '';

                    if (blogs.length === 0) {
                        listContainer.innerHTML = '<p style="color: #888;">No blogs found.</p>';
                        return;
                    }

                    blogs.forEach(blog => {
                        const item = document.createElement('div');
                        item.style.cssText = 'background: #252525; padding: 15px; margin-bottom: 15px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #444;';

                        item.innerHTML = `
                            <div>
                                <h4 style="color: #ffb400; margin: 0; font-size: 1.1em;">${blog.title}</h4>
                                <small style="color: #888;">${new Date(blog.createdAt).toLocaleDateString()}</small>
                            </div>
                            <button class="button" style="padding: 5px 15px; margin: 0; background-color: #ff4b4b; border-color: #ff4b4b;" onclick="deleteBlog(${blog.id})">
                                <span class="button-text" style="padding: 0;">Delete</span>
                            </button>
                        `;
                        listContainer.appendChild(item);
                    });
                });
        }

        // Delete blog
        window.deleteBlog = function (id) {
            if (confirm('Are you sure you want to delete this blog?')) {
                fetch(`/api/blogs/${id}`, { method: 'DELETE' })
                    .then(response => {
                        if (response.ok) {
                            fetchBlogs(); // Refresh list
                        } else {
                            alert('Failed to delete blog');
                        }
                    });
            }
        };

        // Initial fetch
        document.addEventListener('DOMContentLoaded', fetchBlogs);

        document.getElementById('blogForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const title = document.getElementById('title').value;
            const author = document.getElementById('author').value;
            const content = document.getElementById('content').value;
            const image = document.getElementById('image').files[0];

            const formData = new FormData();
            formData.append('title', title);
            formData.append('author', author);
            formData.append('content', content);
            formData.append('image', image);

            fetch('/api/blogs', {
                method: 'POST',
                body: formData
            })
                .then(response => response.json())
                .then(data => {
                    alert('Blog posted successfully!');
                    document.getElementById('blogForm').reset();
                    fetchBlogs(); // Refresh list
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred.');
                });
        });
    </script>
</body>

</html>